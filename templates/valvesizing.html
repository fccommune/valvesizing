{% block content %}
{% include "header.html" %}
<br><br>
<form action="{{url_for('valveSizing', item_id=item.id, proj_id=item.project.id, page=page)}}" method="post">
        
        <div class="row">
                <div class="col-7-5 cvsizing ml-3">
                      
                        <div class="row column-headers">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <!--------------PARAMETER COLUMN-------------->
                                                <div class="col-sm-8 colborder_bottom">
                                                        <div class="row sizingtableleft"><p class="sizingp">Parameters</p></div>
                                                </div>
                                                <div class="col-4 colborder_bottom">
                                                        <div class="row sizingtableleft"><p class="sizingp">Units</p></div>
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                        <div class="col-2 colborder_bottom case{{i+1}}">
                                                                <div class="row sizingtableleft" style="justify-content: space-around; ">
                                                                        <p class="sizingp ml-1" >Case {{i+1}}</p>
                                                                        
                                                                      
                                                                        
                                                                </div>
                                                        </div>
                                                {% else %}
                                                        <div class="col-2 colborder_bottom case{{i+1}}">
                                                                <div class="row sizingtableleft" style="justify-content: space-around; ">
                                                                        <p class="sizingp ml-1">Case {{i+1}}</p>
                                                                        
                                                                        
                                                                </div>
                                                        </div>
                                                {% endif %}
                                                {% endfor %}
                                        </div>
                                </div>
                        </div>
                        <div class="row input-parameters">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <div class="col-sm-8 colborder_bottom">
                                                        <div class="row sizingtableleft_warning"><p class="sizingp">Input</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Flowrate</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">InletPressure</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Outlet Pressure</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Inlet Temperature</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Vapor Pressure</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Specific Gravity</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Viscosity</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Liquid Pr. Recovery</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Valve Style Modifier</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Pressure Drop Ratio</p></div>
                                                        <div class="row sizingtableleft_warning"><p class="sizingp">Output</p></div>
                                                </div>
                                                <div class="col-4 colborder_bottom">
                                                        <div class="row sizingtable_header"></div>
                                                        <div class="row sizingtable">
                                                                
                                                                <select id="#"
                                                                        class="sizingtable_inputs sizingunits" data-desc="flowrate" name="flowrate_unit">
                                                                        ">
                                                                        {% for flowrate in metadata['units_dict']['flowrate'] %}
                                                                                {% if flowrate.id == item.flowrate_unit %}
                                                                                <option value="{{flowrate.id}}" selected>{{flowrate.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{flowrate.id}}">{{flowrate.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs sizingunits" data-desc="inpres" name="inpres_unit">
                                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                                {% if presunit.id == item.inpres_unit %}
                                                                                <option value="{{presunit.id}}" selected>{{presunit.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{presunit.id}}">{{presunit.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs sizingunits" data-desc="outpres" name="outpres_unit">
                                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                                {% if presunit.id == item.outpres_unit %}
                                                                                <option value="{{presunit.id}}" selected>{{presunit.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{presunit.id}}">{{presunit.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs sizingunits" data-desc="temperature" name="temp_unit">
                                                                        {% for temperature in metadata['units_dict']['temperature'] %}
                                                                                {% if temperature.id == item.intemp_unit %}
                                                                                <option value="{{temperature.id}}" selected>{{temperature.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{temperature.id}}">{{temperature.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs sizingunits" data-desc="vaporPres" name="vaporpres_unit">
                                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                                {% if presunit.id == item.vaporpres_unit %}
                                                                                <option value="{{presunit.id}}" selected>{{presunit.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{presunit.id}}">{{presunit.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="centipose">Centipose</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Fl" readonly></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Fd" readonly></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Xt" readonly></div>
                                                        <div class="row sizingtable_header"></div>
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                <div class="col-2 colborder_bottom case{{i+1}}_ip">
                                                        {% if i==length-1 %}    
                                                        <div class="row sizingtable_header_last"></div>
                                                        {% else %}
                                                        <div class="row sizingtable_header"></div>
                                                        {% endif %}
                                                        <div class="row sizingtable"><input type="text" name="flowrate" class="sizingtable_inputs sizingvalue_flowrate" value="{{cases[i].flowrate}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="inletPressure" class="sizingtable_inputs sizingvalue_inpres" value="{{cases[i].inletPressure}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="outletPressure" class="sizingtable_inputs sizingvalue_outpres" value="{{cases[i].outletPressure}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="inletTemp" class="sizingtable_inputs sizingvalue_temperature" value="{{cases[i].inletTemp}}"></div>
                                                        <div class="row sizingtable "><input type="text" name="vaporPressure" class="sizingtable_inputs sizingvalue_vaporPres" value="{{cases[i].vaporPressure}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="specificGravity" class="sizingtable_inputs sizingvalue_sg" value="{{cases[i].specificGravity}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="kinematicViscosity" class="sizingtable_inputs" value="{{cases[i].kinematicViscosity}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="fl" class="sizingtable_inputs" value="{{cases[i].fl}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="fd" class="sizingtable_inputs" value="{{cases[i].fd}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="xt" class="sizingtable_inputs" value="{{cases[i].xt}}"></div>
                                                        {% if i==length-1 %}    
                                                        <div class="row sizingtable_header_last"></div>
                                                        {% else %}
                                                        <div class="row sizingtable_header"></div>
                                                        {% endif %}
                                                </div>
                                                {% else %}
                                                <div class="col-2 colborder_bottom case{{i+1}}_ip">
                                                        {% if i==length-1 %}    
                                                        <div class="row sizingtable_header_last"></div>
                                                        {% else %}
                                                        <div class="row sizingtable_header"></div>
                                                        {% endif %}
                                                        <div class="row sizingtable"><input type="text" {% if i == 0 %} required {% endif %} name="flowrate" class="sizingtable_inputs sizingvalue_flowrate"></div>
                                                        <div class="row sizingtable"><input type="text" {% if i == 0 %} required {% endif %} name="inletPressure" class="sizingtable_inputs sizingvalue_inpres"></div>
                                                        <div class="row sizingtable"><input type="text" {% if i == 0 %} required {% endif %} name="outletPressure" class="sizingtable_inputs sizingvalue_outpres"></div>
                                                        <div class="row sizingtable"><input type="text" {% if i == 0 %} required {% endif %} name="inletTemp" class="sizingtable_inputs sizingvalue_temperature"></div>
                                                        <div class="row sizingtable "><input type="text" {% if i == 0 %} required {% endif %} name="vaporPressure" class="sizingtable_inputs sizingvalue_vaporPres"></div>
                                                        <div class="row sizingtable"><input type="text" {% if i == 0 %} required {% endif %} name="specificGravity" class="sizingtable_inputs sizingvalue_sg"></div>
                                                        <div class="row sizingtable"><input type="text" {% if i == 0 %} required {% endif %} name="kinematicViscosity" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" {% if i == 0 %} required {% endif %} name="fl" value="{{constants['fl']}}" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text"  name="fd" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" {% if i == 0 %} required {% endif %} name="xt" value="{{constants['xt']}}" class="sizingtable_inputs"></div>
                                                        {% if i==length-1 %}    
                                                        <div class="row sizingtable_header_last"></div>
                                                        {% else %}
                                                        <div class="row sizingtable_header"></div>
                                                        {% endif %}
                                                </div>
                                                {% endif %}
                                                {% endfor %}
                                                <div class="sizingicons_container">
                                                        <div class="col-2 mt-4">
                                                            <p onclick="copyFunc()" style="cursor:pointer" >
                                                                <svg height="14" viewBox="0 0 20 20" width="14" xmlns="http://www.w3.org/2000/svg">
                                                                    <g fill="none" stroke="#000">
                                                                        <path d="m3.5 2.5h12v16h-12z"/>
                                                                        <path d="m5 .5h12.5v16.5"/>
                                                                    </g>
                                                                </svg>
                                                            </p>
                                                            
                                                            <p onclick="pasteFunc()" style="cursor:pointer">
                                                                <svg height="18" viewBox="0 0 16 16" width="18" xmlns="http://www.w3.org/2000/svg">
                                                                    <path d="m4.00029246 4.08524952-.00029246 6.41475048c0 1.3254834 1.03153594 2.4100387 2.33562431 2.4946823l.16437569.0053177 4.4143985.000703c-.2061166.5822289-.7615518.999297-1.4143985.999297h-3.5c-1.65685425 0-3-1.3431458-3-3v-5.5c0-.65321869.41754351-1.20891488 1.00029246-1.41475048zm7.49970754-2.08524952c.8284271 0 1.5.67157288 1.5 1.5v7c0 .8284271-.6715729 1.5-1.5 1.5h-5c-.82842712 0-1.5-.6715729-1.5-1.5v-7c0-.82842712.67157288-1.5 1.5-1.5z" fill="#3d4646"/>
                                                                </svg>   
                                                            </p>
                                                            <p onclick="clearData()" style="cursor:pointer">
                                                                <svg width="16" height="16" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                        <path d="M21.8883 13.5C21.1645 18.3113 17.013 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C16.1006 2 19.6248 4.46819 21.1679 8" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                                                        <path d="M17 8H21.4C21.7314 8 22 7.73137 22 7.4V3" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                                                        </svg>
                                                            </p>
                                                            <p class="redirect-delete" style="cursor:pointer"> 
                                                               
                                                                <svg height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
                                                                    <g fill="none" stroke="#000" stroke-width="1">
                                                                        <path d="m16 16-12-12"/>
                                                                        <path d="m16 4-12 12"/>
                                                                    </g>
                                                                </svg>
                                                            </p>
                                                        </div>
                                                </div>
                                                
                                        </div>
                                </div>
                        </div>
                        
                        <div class="row output-parameters">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <div class="col-8 colborder_bottom">
                                                        <div class="row sizingtableleft"><p class="sizingp">Calculated CV</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Open percentage</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Pressure Drop</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Choked pressure drop</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Liq.Critical Pr.Ratio</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Piping Geometry Factor</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Combined Pr.Recovery</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Cavitation Coefficient</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Application Ratio</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Reynolds Number</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Valve SPL</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Valve Dia</p></div>
                                                        <div class="row sizingtableleft_warning"><p class="sizingp"> Velocity</p></div>                      
                                                </div>
                                                <div class="col-4 colborder_bottom">
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="%">%</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs ">
                                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                                {% if presunit.id == item.inpres_unit %}
                                                                                <option value="{{presunit.id}}" selected>{{presunit.name.split(' ')[0]}}</option>
                                                                                
                                                                              
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" ></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Ff" readonly></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Fp" readonly></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Flp" readonly></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Kc" readonly></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Ar" readonly></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="Re" readonly></div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="dBA">dBA</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable_header"></div>
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                <div class="col-2 colborder_bottom case{{i+1}}_op">
                                                        <div class="row sizingtable"><input type="text" class="calculatedcv_row" value="{{cases[i].calculatedCv}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].openingPercentage}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].pressuredrop}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].chokedDrop}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].Ff}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].Fp}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].Flp}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].kc}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].ar}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].reNumber}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].spl}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].valveSize}}"></div>
                                                        {% if i==length-1 %}    
                                                        <div class="row sizingtable_header_last"></div>
                                                        {% else %}
                                                        <div class="row sizingtable_header"></div>
                                                        {% endif %}
                                                </div>
                                                {% else %}
                                                <div class="col-2 colborder_bottom case{{i+1}}_op">
                                                        <div class="row sizingtable"><input type="text" class="calculatedcv_row"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        {% if i==length-1 %}    
                                                        <div class="row sizingtable_header_last"></div>
                                                        {% else %}
                                                        <div class="row sizingtable_header"></div>
                                                        {% endif %}
                                                </div>
                                                {% endif %}
                                                {% endfor %}
                                        </div>
                                </div>
                        </div>

                        <div class="row velocity">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <div class="col-8 colborder_bottom">
                                                        <div class="row sizingtableleft"><p class="sizingp">Pipe In Vel</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Pipeout Vel</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Valve Velocity</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Trim Exit vel</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Power Lvl(kw)</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Require Stages</p></div>
                                                </div>
                                                <div class="col-4 colborder_bottom">
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="m/s">m/s</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="m/s">m/s</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="m/s">m/s</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="m/s">m/s</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                <div class="col-2 colborder_bottom case{{i+1}}_op">
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].pipeInVel}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].pipeOutVel}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].valveVel}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].tex}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].powerLevel}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].requiredStages}}"></div>
                                                </div>
                                                {% else %}
                                                <div class="col-2 colborder_bottom case{{i+1}}_op">
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                </div>
                                                {% endif %}
                                                {% endfor %}
                                        </div>
                                </div>
                        </div>
                </div>

                <div class="col-3-5 cvsizing2 ml-2">
                        <div class="pipedate shadow">
                                <div class="row">
                                        <div class="col-4">
                                                <label>Fluid State</label>
                                        </div>
                                        <div class="col-7">
                                                <select id="fluidState"
                                                        class="form-control-sm-sm valvesizing_select" onchange="handleSelect(this)">
                                                        {% for f_state in metadata['fluidState'] %}
                                                                {% if valve.fluidStateId == f_state.id %}
                                                                        <option value="{{url_for('updateFluidState', fs_id=f_state.id, item_id=item.id, proj_id=item.project.id)}}" selected>{{f_state.name}}</option>
                                                                {% else %}
                                                                        <option value="{{url_for('updateFluidState', fs_id=f_state.id, item_id=item.id, proj_id=item.project.id)}}">{{f_state.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                        <!-- <option>inch</option> -->
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                             <label>Solve For</label>
                                        </div>
                                        <div class="col-7">
                                                <select id="#" class="form-control-sm-sm valvesizing_select">

                                                        <option>Cv</option>
                                                        <option>ΔP</option>
                                                        <option>Flowrate</option>
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label> Fluid Properties</label> 
                                        </div>
                                        <div class="col-3 form-check form-check-inline ml-3">
                                                <input type="radio" name="fluidOption" value="Standard" {% if item.standardStatus %} checked="checked" {%endif%} class="form-control-sm-sm valvesizing_radio">
                                                <label class="ml-1 mt-2">Standard</label>
                                        </div>

                                        <div class="col-3 form-check form-check-inline">
                                                <input type="radio" name="fluidOption" value="Custom" {% if not item.standardStatus %} checked="checked" {%endif%}
                                                        class="form-control-sm-sm valvesizing_radio">
                                                <label class="ml-1 mt-2">Custom</label>

                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Pipe Data</label>  
                                        </div>
                                        <div class="col-3 form-check form-check-inline ml-3">
                                                <input type="radio" value="Standard" name="pipeData" class="stdpipe" {% if item.pipeDataStatus %} checked="checked" {%endif%}
                                                        class="form-control-sm-sm valvesizing_radio">
                                                <label class="ml-1 mt-2">Standard</label>
                                        </div>
                                        <div class="col-3 form-check form-check-inline">
                                                <input type="radio" value="Custom" name="pipeData" class="cuspipe" {% if not item.pipeDataStatus %} checked="checked" {%endif%}
                                                        class="form-control-sm-sm valvesizing_radio">
                                                <label class="ml-1 mt-2">Custom</label>

                                        </div>
                                </div>

                                <h6 >Fluid Data</h6>

                                <div class="row">
                                        <div class="col-4">
                                              <label>Fluid Name</label>
                                        </div>
                                        <div class="col-7">
                                                <select class="form-control-sm-sm valvesizing_select" name="fluid_name" id="fluid_name">
                                                        {% for fluid in metadata['fluids']%}
                                                        {% if cases[0] %}
                                                                {% if cases[0].fluid.id == fluid.id %}
                                                                <option value="{{fluid.id}}" selected>{{fluid.fluidName}}</option>
                                                                {% else %}
                                                                <option value="{{fluid.id}}">{{fluid.fluidName}}</option>
                                                                {% endif %}
                                                        {% else %}
                                                                <option value="{{fluid.id}}">{{fluid.fluidName}}</option>
                                                        {% endif %}
                                                        {% endfor %}
                                                        
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4 pr-0">
                                               <label>Critical Pressure</label> 
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text" name="criticalPressure" required value="{{cases[0].criticalPressure}}"
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% else %}
                                                <input type="text" name="criticalPressure" required value=""
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox sizingvalue_critPres">
                                                {% endif %}
                                        </div>
                                        <div class="col-3">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select sizingunits" data-desc="critPres" name="criticalpres_unit">
                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                {% if presunit.id == item.criticalpres_unit %}
                                                                <option value="{{presunit.id}}" selected>{{presunit.name}}</option>
                                                                {% else %}
                                                                <option value="{{presunit.id}}">{{presunit.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>

                                <h6>Pipe Data</h6>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Inlet Pipe Size</label>  
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text" name="inletPipeSize" required value="{{cases[0].inletPipeSize}}" class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox sizingvalue_inletlength ipipesize">
                                                {% else %}
                                                <input type="text" name="inletPipeSize" required value="" class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox sizingvalue_inletlength ipipesize">
                                                {% endif %}
                                        </div>
                                        <div class="col-3">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select sizingunits ipipeunit" data-desc="inletlength" name="inpipe_unit">
                                                        {% for length in metadata['units_dict']['length'] %}
                                                                {% if length.id == item.inpipe_unit %}
                                                                <option value="{{length.id}}" selected>{{length.name}}</option>
                                                                {% else %}
                                                                <option value="{{length.id}}">{{length.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label>In. Pipe Sch.</label>  
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select iSch" name="iSch">

                                                        {% for pipe_schedule in metadata['units_dict']['pipe_schedule'] %}
                                                        {% if cases[0].iSch == pipe_schedule.name %}
                                                                <option value="{{pipe_schedule.id}}" selected>{{pipe_schedule.name}}</option>
                                                        {% else %}
                                                                <option value="{{pipe_schedule.id}}">{{pipe_schedule.name}}</option>
                                                        {% endif %}
                                                        {% endfor %}
                                                </select>
                                                {% else %}
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select iSch" name="iSch" >

                                                        {% for pipe_schedule in metadata['units_dict']['pipe_schedule'] %}
                                                                <option value="{{pipe_schedule.id}}">{{pipe_schedule.name}}</option>
                                                        
                                                        {% endfor %}
                                                </select>

                                                {% endif %}
                                        </div>
                                        <div class="col-3">
                                                <input type="text" class="form-control-sm-sm valvesizing_inputbox ipipeStatus sizingvalue_inletlength"   name="ipipeStatus" value="{% if cases[0] %} {{cases[0].ipipeStatus}} {% endif %}" required>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4 pr-0">
                                              <label>Outlet Pipe Size</label> 
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text"
                                                        name="outletPipeSize" required value="{{cases[0].outletPipeSize}}"
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox sizingvalue_outletlength opipesize">
                                                {% else %}
                                                <input type="text"
                                                        name="outletPipeSize" required value=""
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox sizingvalue_outletlength opipesize">
                                                {% endif %}
                                                
                                        </div>
                                        <div class="col-3">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select sizingunits opipeunit" data-desc="outletlength" name="outpipe_unit">
                                                        {% for length in metadata['units_dict']['length'] %}
                                                                {% if length.id == item.outpipe_unit %}
                                                                <option value="{{length.id}}" selected>{{length.name}}</option>
                                                                {% else %}
                                                                <option value="{{length.id}}">{{length.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Out. Pipe Sch.  </label>  
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <select
                                                        class="form-control-sm-sm valvesizing_select oSch" name="oSch" >

                                                        {% for pipe_schedule in metadata['units_dict']['pipe_schedule'] %}
                                                        {% if cases[0].oSch == pipe_schedule.name %}
                                                                <option value="{{pipe_schedule.id}}" selected>{{pipe_schedule.name}}</option>
                                                        {% else %}
                                                                <option value="{{pipe_schedule.id}}">{{pipe_schedule.name}}</option>
                                                        {% endif %}
                                                        {% endfor %}
                                                </select>
                                                {% else %}
                                                <select 
                                                        class="form-control-sm-sm valvesizing_select oSch " name="oSch">

                                                        {% for pipe_schedule in metadata['units_dict']['pipe_schedule'] %}
                                                                <option value="{{pipe_schedule.id}}">{{pipe_schedule.name}}</option>
                                                        
                                                        {% endfor %}
                                                </select>

                                                {% endif %}
                                        </div>
                                        <div class="col-3">
                                                <input type="text" class="form-control-sm-sm valvesizing_inputbox opipeStatus sizingvalue_outletlength" name="opipeStatus" required value="{% if cases[0] %} {{cases[0].opipeStatus}} {% endif %}">
                                        </div>
                                </div>

                                <h6>Valve Data</h6>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Valve Size </label></label>  
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text"
                                                name="vSize" value="{{cases[-1].valveSize}}" required
                                                class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox sizingvalue_valvelength">
                                                {% else %}
                                                <input type="text"
                                                name="vSize" value="" required
                                                class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox sizingvalue_valvelength">
                                                {% endif %}
                                                
                                        </div>
                                        <div class="col-3">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select sizingunits" data-desc="valvelength" name="valvesize_unit">
                                                        {% for length in metadata['units_dict']['length'] %}
                                                                {% if length.id == item.valvesize_unit %}
                                                                <option value="{{length.id}}" selected>{{length.name}}</option>
                                                                {% else %}
                                                                <option value="{{length.id}}">{{length.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                             <label>Rated CV</label>   
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text"
                                                        name="ratedCV" value="{{cases[-1].ratedCv}}" required
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% else %}
                                                <input type="text"
                                                        name="ratedCV" value="" required
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% endif %}
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                               <label>Valve Type</label> 
                                        </div>
                                        <div class="col-4">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select">
                                                        {% for valveStyle in metadata['valveStyle'] %}
                                                        {% if valveStyle.name == valve.style.name %}
                                                                <option value="{{valveStyle.id}}" selected>{{valveStyle.name}}</option>
                                                        {% else %}
                                                                <option value="{{valveStyle.id}}" disabled>{{valveStyle.name}}</option>
                                                        {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Trim Type</label>  
                                        </div>
                                        <div class="col-4">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select">
                                                        {% for trimtype in metadata['trimtype'] %}
                                                                {%if trimtype.valveStyleId == metadata['globeStyleId'] or trimtype.valveStyleId == metadata['butterflyStyleId'] %}
                                                                        {% if trimtype.name == valve.trimType__.name %}
                                                                                <option value="{{trimtype.id}}" selected>{{trimtype.name}}</option>
                                                                        {% else %}
                                                                                <option value="{{trimtype.id}}" disabled>{{trimtype.name}}</option>
                                                                        {% endif %}
                                                                {%endif%}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <button type="submit" class="btn btn-info btn-sm  mt-2">Calculate</button>
                                <a href="{{url_for('selectValve', proj_id=item.project.id, item_id=item.id)}}">
                                        <button type="button" class="btn btn-success btn-sm valve_btn2 mt-2">Select Valve</button></a>
                        </div>
                </div>

        </div>
</form>
                

<script type="text/javascript">

             



        $(document).ready(function(){

                const inputs = $('.sizingtable input');
                inputs.each(function(index) {
                        $(this).keydown(function(event) {
                        if (event.key === 'ArrowUp') {
                                event.preventDefault();
                                const prevIndex = (index === 0) ? inputs.length - 1 : index - 1;
                                inputs.eq(prevIndex).focus();
                        } else if (event.key === 'ArrowDown') {
                                event.preventDefault();
                                const nextIndex = (index === inputs.length - 1) ? 0 : index + 1;
                                inputs.eq(nextIndex).focus();
                        }
                        });
                });

                
                var outerarray = []
                $('.colborder_bottom').each(function(index, outerElement) {
                        
                        var innerarray = []
                        $(outerElement).find('.sizingtable input[type="text"]').each(function(innerIndex, inputElement) {
                                innerarray.push($(inputElement));
                                
                        });
                        if(innerarray.length >= 10){
                        outerarray.push(innerarray)
                        }
                        
                });



        
                $('.sizingtable input').focus(function() {
                        const clickedInput = $(this)[0]; 
                        let clickedI, clickedJ; 
                        
                        for (let i = 0; i < outerarray.length; i++) {
                                for (let j = 0; j < outerarray[i].length; j++) {
                                if (outerarray[i][j][0].isSameNode(clickedInput)) {
                                        clickedI = i;
                                        clickedJ = j;
                                        
                                        handleArrowKeys(clickedI, clickedJ);
                                        return; 
                                }
                                }
                        }
                });

                function handleArrowKeys(clickedI, clickedJ) {
                
                $(document).keydown(function(event) {
                        if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                        if (clickedI !== undefined && clickedJ !== undefined) {
                                if (event.key === 'ArrowLeft') {
                                const newI = clickedI === 0 ? outerarray.length - 1 : clickedI - 1;
                                outerarray[newI][clickedJ][0].focus();
                                
                               
                                } else if (event.key === 'ArrowRight') {
                                const newI = (clickedI + 1) % outerarray.length;
                                outerarray[newI][clickedJ][0].focus();
                                
                                
                                }
                        }
                        }
                });

                }






                var prev_unit;
                $('.sizingunits').on('focus', function(){
                        prev_unit = $(this).val();
                });

                $('.sizingunits').on('change', function(){

                        var final_unit = $(this).val();
                        console.log(prev_unit,final_unit);
                        var params = $(this).data('desc');
                        var param_values = []
                        var specificGravity = []

                        $('.sizingvalue_' + params).each(function() {
                                param_values.push(this.value);
                        });
                        $('.sizingvalue_sg').each(function (){
                                specificGravity.push(this.value);
                        })

                        $.ajax({
                                type: "GET",
                                url: "/unit_change",
                                data: {
                                prev_unit: prev_unit,
                                final_unit: final_unit,
                                params: params,     
                                param_values: JSON.stringify(param_values),
                                specific_gravity: JSON.stringify(specificGravity)
                                },
                                success: function(response) {
                                        ans_values = $.parseJSON(response)
                                        console.log('ans',ans_values)
                                        $('.sizingvalue_' + params).each(function(index) {
                                                $(this).val(ans_values[index]);
                                        });
                                },
                                error: function(xhr, status, error) {
                                console.error("Error:", error);
                                }
                        });

                        prev_unit = final_unit;
                });
        });

                





                        var copiedOuptput = {value: NaN}
                        function clearData(obj) {
                                var class_hide = "." + obj.className;
                                let res = $(class_hide + ' input').map(function(){
                                        return $(this).val('');
                                });
                        };

                        function handleSelect(elm) {
                                // alert('js working for fstate')
                                window.location = elm.value
                        };

                        function copyPaste(obj) {

                                var class_hide = "." + obj.className;
                                alert(class_hide)
                                let res = $(class_hide + ' input').map(function(){
                                        return $(this).val();
                                }).get();
                                console.log(res);
                                copiedOuptput.value = res
                                alert('Values Copied from ' + obj.className)

                        };

                        function paste(obj) {
                                var class_hide = "." + obj.className;
                                let res2 = $(class_hide + ' input');
                                copiedOuptput.value.map((value, index) => {
                                        res2[index].value = value;
                                }); 
                        };
                </script>
                <script>
                        function replaceNoneValues() {
                                // Select all input elements
                                var inputs = document.getElementsByTagName('input');
                                
                                // Loop through each input element
                                for (var i = 0; i < inputs.length; i++) {
                                        // Check if the value is 'None'
                                        if (inputs[i].value === 'None') {
                                        // If value is 'None', replace it with an empty string
                                        //     alert(inputs[i].value)
                                        inputs[i].value = '';
                                        }
                                }
                                }
                        
                        window.onload = function () {
                                replaceNoneValues();
                                var fluid_dict = JSON.parse({{metadata['fluids_dict']|tojson}});
                                var case_len = "{{total_length}}";
                                var fluidName_ = document.getElementById("fluid_name");
                                fluidName_.onchange = function () {
                                        var selected_fluid = $("#fluid_name :selected").text()
                                        var fluid_option = $("input[name='fluidOption']:checked").val()
                                        alert(fluid_option)
                                        var fluid_name_ = $("#fluid_name :selected").text();
                                        console.log(fluid_dict[selected_fluid].viscosity);
                                        if (fluid_option == 'Standard') {
                                                $("input[name='kinematicViscosity']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = fluid_dict[selected_fluid].viscosity;
                                                        };
                                                });
                                                $("input[name='vaporPressure']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = fluid_dict[selected_fluid].vaporPressure;
                                                        };
                                                });
                                                $("input[name='specificGravity']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = fluid_dict[selected_fluid].specificGravity;
                                                        };
                                                });
                                                $("input[name='criticalPressure']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = fluid_dict[selected_fluid].criticalPressure;
                                                        };
                                                });
                                                alert(fluid_name_);

                                        } else {
                                                $("input[name='kinematicViscosity']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = "";
                                                        };
                                                });
                                                
                                                $("input[name='vaporPressure']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = "";
                                                        };
                                                });
                                                $("input[name='specificGravity']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = "";
                                                        }
                                                });
                                                $("input[name='criticalPressure']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = "";
                                                        }
                                                });
                                        };
                                };
                        };
                </script>

<script>
        var lastClass;
        var copiedClass;
        $(document).ready(function(){
                if ($(".stdpipe").prop("checked")){
                               
                                $('.ipipeStatus').prop('readonly', true);
                                
                                $('.opipeStatus').prop('readonly', true);
                                $('.iSch').prop('disabled', false);
                                $('.oSch').prop('disabled', false);
                        }
                        else if($('.cuspipe').prop("checked")){
                                $('.ipipeStatus').prop('readonly', false);
                                $('.opipeStatus').prop('readonly', false);
                               
                                $('.iSch').prop('disabled', true);
                                $('.oSch').prop('disabled', true);
                                
                               
                            
                        }
                $(".stdpipe, .cuspipe").change(function(){
                       
                        if ($(".stdpipe").prop("checked")){
                              
                                $('.ipipeStatus').prop('readonly', true);
                                
                                $('.opipeStatus').prop('readonly', true);
                                $('.iSch').prop('disabled', false);
                                $('.oSch').prop('disabled', false);
                        }
                        else if($('.cuspipe').prop("checked")){
                                $('.ipipeStatus').prop('readonly', false);
                                $('.opipeStatus').prop('readonly', false);
                               
                                $('.iSch').prop('disabled', true);
                                $('.oSch').prop('disabled', true);
                                
                               
                            
                        }
                })

                $(".iSch").change(function() {
                       
                        alert('onchange')
                        ipipesize = $('.ipipesize').val()
                        ipipeunit = $('.ipipeunit').val()
                        value = $('.iSch').val()
                        console.log('ksksksksksk',ipipesize,ipipeunit,value)
                        $.ajax({
                                type: "GET",
                                url: "/getpipe_sch",
                                data: {
                                        pipesize: ipipesize,
                                        pipeunit: ipipeunit,
                                        Sch: value,     
                                },
                                success: function(response) {
                                        $('.ipipeStatus').val(response)
                                        console.log('ans',response)
                                      					
									
                                },
                                error: function(xhr, status, error) {
                                console.error("Error:", error);
                                }
                        });
                })
                $(".oSch").change(function() {
                        opipesize = $('.opipesize').val()
                        opipeunit = $('.opipeunit').val()
                        value = $('.oSch').val()
                        console.log('ksksksksksk',ipipesize,ipipeunit,value)
                        $.ajax({
                                type: "GET",
                                url: "/getpipe_sch",
                                data: {
                                        pipesize: opipesize,
                                        pipeunit: opipeunit,
                                        Sch: value,     
                                },
                                success: function(response) {
                                        $('.opipeStatus').val(response)
                                        console.log('ans',response)
                                      					
									
                                },
                                error: function(xhr, status, error) {
                                console.error("Error:", error);
                                }
                        });
                })

        })

        
        $("input").focus(function(){
                var parent_ = $(this).parent().parent();
                parentclass = parent_.attr('class').split(' ');
                lastClass = parentclass[parentclass.length - 1];
                console.log('parentclass',lastClass);

    });
    function copyFunc(){
  
        var class_hide = "." + lastClass;
        copiedClass = class_hide
        console.log('input',class_hide)
       
        let res = $(class_hide + ' input').map(function(){
                $(this).css('background-color', '#d2e9d2');
                return $(this).val();
        }).get();
        console.log('res',res);
        copiedOuptput.value = res
        


    }
    function pasteFunc(){

        var class_hide = "." + lastClass;
        $(copiedClass + ' input').css('background-color', '');
        let res2 = $(class_hide + ' input');
        
        copiedOuptput.value.map((value, index) => {
                res2[index].value = value;
        }); 

    }
    function clearData(){
        var class_hide = "." + lastClass;
        let res = $(class_hide + ' input').map(function(){
              
                return $(this).val('');
        });
    }
    $('.redirect-delete').click(function(e){

        var number = parseInt(lastClass.substring(4, 5)) -1;
        var item_id =  "{{ item.id }}"
        var project_id = "{{ item.project.id }}"
        console.log('ITEM',item_id)
        console.log(number, item_id, project_id)
        e.preventDefault(); 
        alert(number);
        $.ajax({
        type: "GET",
        url: "/itemCaseDelete",
        data: {
            item_id: item_id,
            proj_id: project_id,
            case_id: number
        },
        success: function(response) {
            // Handle success response  
            
            console.log("Redirected successfully.");
        },
        error: function(xhr, status, error) {
            // Handle error
            console.error("Error:", error);
        }
    });
       
      
    })
</script>

{% include "footer.html" %}
{% endblock %}